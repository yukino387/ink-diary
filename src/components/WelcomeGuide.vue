<template>
  <Teleport to="body">
    <Transition name="modal">
      <div v-if="show" class="welcome-overlay">
        <div class="welcome-dialog">
          <!-- å·¦ä¾§è£…é¥° -->
          <div class="welcome-decoration">
            <div class="ink-stamp">å¢¨</div>
            <div class="decoration-line"></div>
            <div class="decoration-pattern"></div>
          </div>

          <!-- å³ä¾§å†…å®¹ -->
          <div class="welcome-content">
            <!-- å¤´éƒ¨ -->
            <div class="welcome-header">
              <h1 class="welcome-title">
                <span class="title-icon">ğŸ“œ</span>
                æ¬¢è¿ä½¿ç”¨å¢¨è®°
              </h1>
              <p class="welcome-subtitle">æ‚¨çš„ç§å¯†æ•°å­—æ–‡æˆ¿</p>
            </div>

            <!-- åŠŸèƒ½ä»‹ç» -->
            <div class="features-section">
              <h3 class="section-title">
                <span class="section-icon">âœ¨</span>
                æ ¸å¿ƒåŠŸèƒ½
              </h3>
              <div class="features-grid">
                <div class="feature-card" style="--delay: 0.1s">
                  <div class="feature-icon-wrapper">
                    <span class="feature-icon">ğŸ“</span>
                  </div>
                  <div class="feature-info">
                    <h4>æ’°å†™æ—¥è®°</h4>
                    <p>ä½¿ç”¨ Markdown ç¼–è¾‘å™¨è®°å½•ç”Ÿæ´»ç‚¹æ»´ï¼Œæ”¯æŒå®æ—¶é¢„è§ˆå’Œå›¾æ–‡æ··æ’</p>
                  </div>
                </div>
                <div class="feature-card" style="--delay: 0.2s">
                  <div class="feature-icon-wrapper">
                    <span class="feature-icon">ğŸ”’</span>
                  </div>
                  <div class="feature-info">
                    <h4>æœ¬åœ°å­˜å‚¨</h4>
                    <p>æ‰€æœ‰æ•°æ®ä»…ä¿å­˜åœ¨æ‚¨çš„è®¾å¤‡ä¸Šï¼Œä¸ä¸Šä¼ äº‘ç«¯ï¼Œä¿æŠ¤éšç§å®‰å…¨</p>
                  </div>
                </div>
                <div class="feature-card" style="--delay: 0.3s">
                  <div class="feature-icon-wrapper">
                    <span class="feature-icon">ğŸ¨</span>
                  </div>
                  <div class="feature-info">
                    <h4>å¿ƒæƒ…æ ‡ç­¾</h4>
                    <p>ä¸ºæ¯ç¯‡æ—¥è®°é€‰æ‹©å¿ƒæƒ…æ ‡ç­¾å’Œè§†è§‰é£æ ¼ï¼Œè®©è®°å½•æ›´ç”ŸåŠ¨</p>
                  </div>
                </div>
                <div class="feature-card" style="--delay: 0.4s">
                  <div class="feature-icon-wrapper">
                    <span class="feature-icon">ğŸ”</span>
                  </div>
                  <div class="feature-info">
                    <h4>æ™ºèƒ½æœç´¢</h4>
                    <p>å¿«é€Ÿæœç´¢æ—¥è®°å†…å®¹ï¼Œæ”¯æŒå…³é”®è¯åŒ¹é…å’Œå¯é€‰çš„ AI è¯­ä¹‰æœç´¢</p>
                  </div>
                </div>
                <div class="feature-card" style="--delay: 0.5s">
                  <div class="feature-icon-wrapper">
                    <span class="feature-icon">ğŸ“¤</span>
                  </div>
                  <div class="feature-info">
                    <h4>æ•°æ®ç®¡ç†</h4>
                    <p>æ”¯æŒåŠ å¯†å¯¼å‡ºã€å¯¼å…¥å’Œå¤‡ä»½ï¼Œå®Œæ•´æŒæ§è‡ªå·±çš„æ•°æ®</p>
                  </div>
                </div>
                <div class="feature-card" style="--delay: 0.6s">
                  <div class="feature-icon-wrapper">
                    <span class="feature-icon">ğŸ¤–</span>
                  </div>
                  <div class="feature-info">
                    <h4>AI åŠŸèƒ½</h4>
                    <p>å¯é€‰çš„ AI è¾…åŠ©åŠŸèƒ½ï¼Œéœ€è‡ªè¡Œé…ç½® API å¯†é’¥ï¼ˆå®Œå…¨è‡ªæ„¿ï¼‰</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- å¿«é€Ÿå¼€å§‹ -->
            <div class="quick-start-section">
              <h3 class="section-title">
                <span class="section-icon">ğŸš€</span>
                å¿«é€Ÿå¼€å§‹
              </h3>
              <div class="steps-list">
                <div class="step-item" style="--step-index: 0">
                  <div class="step-number">1</div>
                  <div class="step-content">
                    <h4>åˆ›å»ºç¬¬ä¸€ç¯‡æ—¥è®°</h4>
                    <p>ç‚¹å‡»å·¦ä¾§èœå•çš„"æ–°å»º"æŒ‰é’®ï¼Œå¼€å§‹è®°å½•æ‚¨çš„ç”Ÿæ´»ç‚¹æ»´</p>
                  </div>
                </div>
                <div class="step-item" style="--step-index: 1">
                  <div class="step-number">2</div>
                  <div class="step-content">
                    <h4>æµè§ˆæ—¥è®°é˜</h4>
                    <p>åœ¨"æ—¥è®°é˜"ä¸­æŸ¥çœ‹ã€æœç´¢å’Œç®¡ç†æ‚¨çš„æ‰€æœ‰æ—¥è®°</p>
                  </div>
                </div>
                <div class="step-item" style="--step-index: 2">
                  <div class="step-number">3</div>
                  <div class="step-content">
                    <h4>é…ç½® AI åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰</h4>
                    <p>å¦‚éœ€ä½¿ç”¨ AI æœç´¢ï¼Œå‰å¾€"è®¾ç½®"é…ç½® API å¯†é’¥</p>
                  </div>
                </div>
                <div class="step-item" style="--step-index: 3">
                  <div class="step-number">4</div>
                  <div class="step-content">
                    <h4>å®šæœŸå¤‡ä»½æ•°æ®</h4>
                    <p>ä½¿ç”¨å¯¼å‡ºåŠŸèƒ½å®šæœŸå¤‡ä»½ï¼Œé˜²æ­¢æµè§ˆå™¨æ•°æ®ä¸¢å¤±</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- é‡è¦æç¤º -->
            <div class="tips-section">
              <h3 class="section-title">
                <span class="section-icon">ğŸ’¡</span>
                é‡è¦æç¤º
              </h3>
              <div class="tips-list">
                <div class="tip-item">
                  <span class="tip-icon">ğŸ“Œ</span>
                  <p>æ‰€æœ‰æ•°æ®é»˜è®¤ä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ä¸­ï¼Œæ¸…ç†æµè§ˆå™¨ç¼“å­˜å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±</p>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">ğŸ”</span>
                  <p>å¯ç”¨å¯†ç ä¿æŠ¤åï¼Œè¯·åŠ¡å¿…ç‰¢è®°å¯†ç ï¼Œé—å¿˜å°†æ— æ³•æ¢å¤æ•°æ®</p>
                </div>
                <div class="tip-item">
                  <span class="tip-icon">ğŸ¤–</span>
                  <p>AI åŠŸèƒ½éœ€è¦æ‚¨è‡ªè¡Œé…ç½® API å¯†é’¥ï¼Œæ•°æ®å°†å‘é€åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡</p>
                </div>
              </div>
            </div>

            <!-- åº•éƒ¨æŒ‰é’® -->
            <div class="welcome-footer">
              <label class="show-again-checkbox">
                <input
                  v-model="showOnStartup"
                  type="checkbox"
                />
                <span>æ¯æ¬¡å¯åŠ¨æ—¶æ˜¾ç¤ºæ­¤é¡µé¢</span>
              </label>
              <button class="btn-start" @click="startUsing">
                <span class="btn-icon">âœ¨</span>
                å¼€å§‹ä½¿ç”¨å¢¨è®°
              </button>
            </div>
          </div>
        </div>
      </div>
    </Transition>
  </Teleport>
</template>

<script setup>
import { ref, watch } from 'vue'

/**
 * WelcomeGuide - é¦–æ¬¡ä½¿ç”¨æ¬¢è¿é¡µé¢
 * 
 * åŠŸèƒ½ï¼š
 * - å‘æ–°ç”¨æˆ·ä»‹ç»å¢¨è®°çš„æ ¸å¿ƒåŠŸèƒ½
 * - æä¾›å¿«é€Ÿå¼€å§‹æŒ‡å—
 * - æ˜¾ç¤ºé‡è¦ä½¿ç”¨æç¤º
 * - å¯é€‰æ‹©ä¸‹æ¬¡ä¸å†æ˜¾ç¤º
 */

const props = defineProps({
  show: {
    type: Boolean,
    default: false
  }
})

const emit = defineEmits(['close'])

// çŠ¶æ€ - é»˜è®¤ä¸å‹¾é€‰ï¼ˆå³é»˜è®¤ä¸‹æ¬¡ä¸æ˜¾ç¤ºï¼‰
const showOnStartup = ref(false)

// å¼€å§‹ä½¿ç”¨
function startUsing() {
  // å¦‚æœå‹¾é€‰äº†"æ¯æ¬¡å¯åŠ¨æ—¶æ˜¾ç¤º"ï¼Œåˆ™ dontShowAgain ä¸º false
  // å¦‚æœæ²¡å‹¾é€‰ï¼Œåˆ™ dontShowAgain ä¸º trueï¼ˆä¸‹æ¬¡ä¸å†æ˜¾ç¤ºï¼‰
  emit('close', !showOnStartup.value)
}

// ç›‘å¬æ˜¾ç¤ºçŠ¶æ€ï¼Œé‡ç½®å¤é€‰æ¡†
watch(() => props.show, (newVal) => {
  if (newVal) {
    showOnStartup.value = false
  }
})
</script>

<style scoped>
/* Teleport æ¨¡æ€æ¡†è¿‡æ¸¡åŠ¨ç”» */
.modal-enter-active,
.modal-leave-active {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-enter-from,
.modal-leave-to {
  opacity: 0;
}

.modal-enter-from .welcome-dialog,
.modal-leave-to .welcome-dialog {
  opacity: 0;
  transform: translateY(50px) scale(0.95);
}

/* é®ç½©å±‚ */
.welcome-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(44, 62, 80, 0.92) 0%, rgba(44, 62, 80, 0.85) 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  backdrop-filter: blur(12px);
  padding: 2rem;
}

/* å¯¹è¯æ¡† */
.welcome-dialog {
  background: linear-gradient(135deg, #fefcf5 0%, #fdfbf7 100%);
  border-radius: 20px;
  box-shadow: 0 30px 100px rgba(0, 0, 0, 0.4), 0 15px 40px rgba(0, 0, 0, 0.2);
  width: 100%;
  max-width: 900px;
  max-height: 90vh;
  display: flex;
  overflow: hidden;
  animation: dialogSlideUp 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  border: 1px solid rgba(139, 69, 19, 0.15);
}

@keyframes dialogSlideUp {
  from {
    opacity: 0;
    transform: translateY(50px) scale(0.95);
  }
  to {
    opacity: 1;
    transform: translateY(0) scale(1);
  }
}

/* å·¦ä¾§è£…é¥° */
.welcome-decoration {
  width: 120px;
  background: linear-gradient(180deg, rgba(139, 69, 19, 0.08) 0%, rgba(139, 69, 19, 0.03) 100%);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2rem 0;
  position: relative;
  overflow: hidden;
}

.ink-stamp {
  width: 80px;
  height: 80px;
  background: linear-gradient(135deg, var(--ink-ochre, #8b4513) 0%, #a0522d 100%);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: "LXGW WenKai", serif;
  font-size: 2.5rem;
  color: #fefcf5;
  box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
  animation: stampIn 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55) 0.3s both;
  position: relative;
  z-index: 1;
}

@keyframes stampIn {
  0% {
    opacity: 0;
    transform: scale(1.5) rotate(-10deg);
  }
  50% {
    transform: scale(0.9) rotate(2deg);
  }
  100% {
    opacity: 1;
    transform: scale(1) rotate(0);
  }
}

.decoration-line {
  flex: 1;
  width: 2px;
  background: linear-gradient(180deg, transparent 0%, var(--ink-sandalwood, #c1a173) 20%, var(--ink-sandalwood, #c1a173) 80%, transparent 100%);
  margin: 1.5rem 0;
  opacity: 0.5;
}

.decoration-pattern {
  width: 60px;
  height: 60px;
  background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%238b4513' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E") repeat;
  opacity: 0.6;
}

/* å³ä¾§å†…å®¹ */
.welcome-content {
  flex: 1;
  padding: 2rem 2.5rem;
  overflow-y: auto;
  scroll-behavior: smooth;
}

/* è‡ªå®šä¹‰æ»šåŠ¨æ¡ */
.welcome-content::-webkit-scrollbar {
  width: 6px;
}

.welcome-content::-webkit-scrollbar-track {
  background: rgba(139, 69, 19, 0.05);
  border-radius: 3px;
}

.welcome-content::-webkit-scrollbar-thumb {
  background: var(--ink-sandalwood, #c1a173);
  border-radius: 3px;
}

/* å¤´éƒ¨ */
.welcome-header {
  text-align: center;
  margin-bottom: 2rem;
  animation: fadeInUp 0.6s ease-out 0.2s both;
}

.welcome-title {
  font-family: "LXGW WenKai", serif;
  font-size: 2rem;
  font-weight: 400;
  color: var(--ink-dark, #2c3e50);
  margin-bottom: 0.5rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.title-icon {
  font-size: 2.25rem;
  animation: iconFloat 3s ease-in-out infinite;
}

@keyframes iconFloat {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-5px); }
}

.welcome-subtitle {
  font-family: "LXGW WenKai", serif;
  font-size: 1.1rem;
  color: var(--ink-sandalwood, #c1a173);
  letter-spacing: 0.1em;
}

/* åŒºå—æ ‡é¢˜ */
.section-title {
  font-family: "LXGW WenKai", serif;
  font-size: 1.15rem;
  font-weight: 400;
  color: var(--ink-dark, #2c3e50);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid var(--ink-rice, #d4b483);
}

.section-icon {
  font-size: 1.25rem;
}

/* åŠŸèƒ½ä»‹ç» */
.features-section {
  margin-bottom: 2rem;
  animation: fadeInUp 0.6s ease-out 0.3s both;
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

.feature-card {
  display: flex;
  align-items: flex-start;
  gap: 0.875rem;
  padding: 1rem;
  background: rgba(255, 255, 255, 0.7);
  border-radius: 10px;
  border: 1px solid rgba(139, 69, 19, 0.08);
  transition: all 0.3s ease;
  animation: fadeInUp 0.5s ease-out both;
  animation-delay: calc(var(--delay) + 0.4s);
}

.feature-card:hover {
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  transform: translateY(-2px);
  border-color: rgba(139, 69, 19, 0.15);
}

.feature-icon-wrapper {
  width: 44px;
  height: 44px;
  min-width: 44px;
  background: linear-gradient(135deg, rgba(139, 69, 19, 0.1) 0%, rgba(139, 69, 19, 0.05) 100%);
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

.feature-card:hover .feature-icon-wrapper {
  transform: scale(1.1) rotate(-5deg);
  background: linear-gradient(135deg, rgba(139, 69, 19, 0.15) 0%, rgba(139, 69, 19, 0.08) 100%);
}

.feature-icon {
  font-size: 1.5rem;
}

.feature-info h4 {
  font-family: "LXGW WenKai", serif;
  font-size: 0.9375rem;
  font-weight: 400;
  color: var(--ink-dark, #2c3e50);
  margin-bottom: 0.25rem;
}

.feature-info p {
  font-family: "LXGW WenKai", serif;
  font-size: 0.8125rem;
  color: var(--ink-sandalwood, #c1a173);
  line-height: 1.5;
  margin: 0;
}

/* å¿«é€Ÿå¼€å§‹ */
.quick-start-section {
  margin-bottom: 2rem;
  animation: fadeInUp 0.6s ease-out 0.5s both;
}

.steps-list {
  display: flex;
  flex-direction: column;
  gap: 0.875rem;
}

.step-item {
  display: flex;
  align-items: flex-start;
  gap: 1rem;
  padding: 1rem;
  background: linear-gradient(135deg, rgba(139, 69, 19, 0.03) 0%, rgba(139, 69, 19, 0.01) 100%);
  border-radius: 10px;
  border-left: 3px solid var(--ink-ochre, #8b4513);
  animation: slideInRight 0.5s ease-out both;
  animation-delay: calc(var(--step-index) * 0.1s + 0.6s);
  transition: all 0.3s ease;
}

.step-item:hover {
  background: linear-gradient(135deg, rgba(139, 69, 19, 0.06) 0%, rgba(139, 69, 19, 0.02) 100%);
  transform: translateX(4px);
}

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.step-number {
  width: 32px;
  height: 32px;
  min-width: 32px;
  background: linear-gradient(135deg, var(--ink-ochre, #8b4513) 0%, #a0522d 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: "LXGW WenKai", serif;
  font-size: 0.875rem;
  font-weight: 600;
  color: white;
  box-shadow: 0 2px 8px rgba(139, 69, 19, 0.25);
}

.step-content h4 {
  font-family: "LXGW WenKai", serif;
  font-size: 0.9375rem;
  font-weight: 400;
  color: var(--ink-dark, #2c3e50);
  margin-bottom: 0.25rem;
}

.step-content p {
  font-family: "LXGW WenKai", serif;
  font-size: 0.8125rem;
  color: var(--ink-sandalwood, #c1a173);
  line-height: 1.5;
  margin: 0;
}

/* æç¤º */
.tips-section {
  margin-bottom: 2rem;
  animation: fadeInUp 0.6s ease-out 0.7s both;
}

.tips-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.tip-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.875rem 1rem;
  background: linear-gradient(135deg, rgba(255, 193, 7, 0.08) 0%, rgba(255, 193, 7, 0.02) 100%);
  border-radius: 8px;
  border: 1px solid rgba(255, 193, 7, 0.2);
  transition: all 0.3s ease;
}

.tip-item:hover {
  background: linear-gradient(135deg, rgba(255, 193, 7, 0.12) 0%, rgba(255, 193, 7, 0.04) 100%);
  transform: translateX(4px);
}

.tip-icon {
  font-size: 1.25rem;
  min-width: 1.5rem;
}

.tip-item p {
  font-family: "LXGW WenKai", serif;
  font-size: 0.875rem;
  color: #856404;
  line-height: 1.6;
  margin: 0;
}

/* åº•éƒ¨ */
.welcome-footer {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding-top: 1.5rem;
  border-top: 1px dashed var(--ink-rice, #d4b483);
  animation: fadeInUp 0.6s ease-out 0.8s both;
}

.show-again-checkbox {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  cursor: pointer;
  font-family: "LXGW WenKai", serif;
  font-size: 0.875rem;
  color: var(--ink-sandalwood, #c1a173);
  transition: color 0.3s ease;
}

.show-again-checkbox:hover {
  color: var(--ink-ochre, #8b4513);
}

.show-again-checkbox input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: var(--ink-ochre, #8b4513);
}

.btn-start {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.875rem 1.75rem;
  background: linear-gradient(135deg, var(--ink-ochre, #8b4513) 0%, #a0522d 100%);
  color: white;
  border: none;
  border-radius: 10px;
  font-family: "LXGW WenKai", serif;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 15px rgba(139, 69, 19, 0.3);
}

.btn-start:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(139, 69, 19, 0.4);
}

.btn-start:active {
  transform: translateY(0);
}

.btn-icon {
  font-size: 1.25rem;
}

/* åŠ¨ç”» */
@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* å“åº”å¼ */
@media (max-width: 768px) {
  .welcome-overlay {
    padding: 1rem;
  }
  
  .welcome-dialog {
    flex-direction: column;
    max-height: 95vh;
  }
  
  .welcome-decoration {
    width: 100%;
    height: 80px;
    flex-direction: row;
    padding: 1rem;
    justify-content: center;
  }
  
  .decoration-line,
  .decoration-pattern {
    display: none;
  }
  
  .welcome-content {
    padding: 1.5rem;
  }
  
  .welcome-title {
    font-size: 1.5rem;
  }
  
  .features-grid {
    grid-template-columns: 1fr;
  }
  
  .welcome-footer {
    flex-direction: column;
    gap: 1rem;
  }
  
  .btn-start {
    width: 100%;
    justify-content: center;
  }
}
</style>
